<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ details.piece }} ({{ instrument }}) - é–²è¦§</title>
    <style>
        body { font-family: sans-serif; background: #e9ecef; padding: 20px; color: #333; text-align: center; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: left; }
        h1 { color: #2c3e50; margin-bottom: 5px; text-align: center; }
        .btn-back { display: inline-block; background: #95a5a6; color: white; padding: 10px 15px; border-radius: 4px; text-decoration: none; margin-bottom: 20px; font-weight: bold; }
        .flash-message { background: #d4edda; color: #155724; padding: 10px; border-radius: 4px; margin-bottom: 20px; text-align: center; font-weight: bold; }
        
        .print-box { background: #f0f8ff; border: 1px dashed #3498db; padding: 15px; border-radius: 8px; margin-bottom: 30px; display: flex; gap: 15px; align-items: center; flex-wrap: wrap; justify-content: center; }
        .print-box select, .print-box input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; }
        .print-box button { background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 1.1em; transition: 0.2s; }
        .print-box button:hover { background: #c0392b; }
        
        .score-grid { display: flex; flex-direction: column; gap: 30px; align-items: center; }
        .score-page { max-width: 100%; border: 1px solid #ccc; box-shadow: 0 4px 8px rgba(0,0,0,0.2); background: white; }
    </style>
</head>
<body>
    <div class="container">
        <a href="{{ url_for('piece_details', id=details.id) }}" class="btn-back">â—€ è©³ç´°ç”»é¢ã¸æˆ»ã‚‹</a>

        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="flash-message">
              {% for message in messages %}
                <p style="margin:0;">{{ message }}</p>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <h1>{{ details.piece }}</h1>
        <h2 style="text-align: center; color: #34495e; margin-top: 0;">ğŸ¼ {{ instrument }}</h2>
        <p style="text-align: center; color: #666;">å…¨ {{ filenames|length }} ãƒšãƒ¼ã‚¸</p>

        <form action="{{ url_for('output_action') }}" method="POST" class="print-box">
            <h3 style="margin: 0; color: #2980b9; display: flex; align-items: center;">ğŸ–¨ï¸ å°åˆ·æŒ‡ç¤º</h3>
            
            <input type="hidden" name="directory" value="{{ target_dir }}">
            <input type="hidden" name="score_id" value="{{ details.id }}">
            <input type="hidden" name="piece" value="{{ details.piece }}">
            <input type="hidden" name="instrument" value="{{ instrument }}">
            <input type="hidden" name="action_type" value="print">
            <input type="hidden" name="from_view" value="1"> <label style="font-weight: bold;">ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ: 
                <select name="mode">
                    <option value="1in1">1 in 1 (A4)</option>
                    <option value="2in1">2 in 1 (A3)</option>
                    <option value="booklet">å°å†Šå­ (A3)</option>
                </select>
            </label>
            
            <label style="font-weight: bold;">ãƒ—ãƒªãƒ³ã‚¿å: 
                <input type="text" name="printer" placeholder="æŒ‡å®šãªã—" style="width: 120px;">
            </label>
            
            <button type="submit" onclick="this.innerHTML='é€ä¿¡ä¸­...'; this.style.opacity='0.7';">ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å°åˆ·ã‚’å®Ÿè¡Œ</button>
        </form>

        <hr style="margin-bottom: 30px;">

        <div class="score-grid">
            {% for filename in filenames %}
                <div>
                    <h4 style="color:#7f8c8d; text-align:center; margin-bottom:8px;">Page {{ loop.index }}</h4>
                    <img src="{{ url_for('score_image', score_id=details.id, instrument=instrument, filename=filename) }}" class="score-page" loading="lazy">
                </div>
            {% endfor %}
        </div>
        
        <div style="text-align: center; margin-top: 40px;">
            <a href="#top" style="color: #3498db; text-decoration: none; font-weight: bold;">â–² ãƒšãƒ¼ã‚¸ã®ä¸€ç•ªä¸Šã¸æˆ»ã‚‹</a>
        </div>
    </div>
</body>
</html>