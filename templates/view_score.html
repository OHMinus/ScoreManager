<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ details.piece }} ({{ instrument }}) - é–²è¦§</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="page-view">
    <div class="container">
        <a href="{{ url_for('piece_details', id=details.id) }}" class="btn-back">â—€ è©³ç´°ç”»é¢ã¸æˆ»ã‚‹</a>

        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="flash-message">
              {% for message in messages %}
                <p style="margin:0;">{{ message }}</p>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <h1>{{ details.piece }}</h1>
        <h2 style="text-align: center; color: #34495e; margin-top: 0;">ğŸ¼ {{ instrument }}</h2>
        <p style="text-align: center; color: #666;">å…¨ {{ filenames|length }} ãƒšãƒ¼ã‚¸</p>

        <form action="{{ url_for('output_action') }}" method="POST" class="print-box">
            <h3 style="margin: 0; color: #2980b9; display: flex; align-items: center;">ğŸ–¨ï¸ å°åˆ·æŒ‡ç¤º</h3>
            
            <input type="hidden" name="directory" value="{{ target_dir }}">
            <input type="hidden" name="score_id" value="{{ details.id }}">
            <input type="hidden" name="piece" value="{{ details.piece }}">
            <input type="hidden" name="instrument" value="{{ instrument }}">
            <input type="hidden" name="action_type" value="print">
            <input type="hidden" name="from_view" value="1"> <label style="font-weight: bold;">ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ: 
                <select name="mode">
                    <option value="1in1">1 in 1 (A4)</option>
                    <option value="2in1">2 in 1 (A3)</option>
                    <option value="booklet">å°å†Šå­ (A3)</option>
                </select>
            </label>
            
            <label style="font-weight: bold;">ãƒ—ãƒªãƒ³ã‚¿å: 
                <input type="text" name="printer" placeholder="æŒ‡å®šãªã—" style="width: 120px;">
            </label>
            
            <button type="submit">ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å°åˆ·ã‚’å®Ÿè¡Œ</button>
        </form>

        <hr style="margin-bottom: 30px;">

        <div class="score-grid">
            {% for filename in filenames %}
                <div>
                    <h4 style="color:#7f8c8d; text-align:center; margin-bottom:8px;">Page {{ loop.index }}</h4>
                    <img src="{{ url_for('score_image', score_id=details.id, instrument=instrument, filename=filename) }}" class="score-page" loading="lazy">
                </div>
            {% endfor %}
        </div>
        
        <div style="text-align: center; margin-top: 40px;">
            <a href="#top" style="color: #3498db; text-decoration: none; font-weight: bold;">â–² ãƒšãƒ¼ã‚¸ã®ä¸€ç•ªä¸Šã¸æˆ»ã‚‹</a>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/ui.js') }}"></script>
</body>
</html>